<?php declare(strict_types=1);

namespace Reconmap\Controllers\Vulnerabilities;

use Psr\Http\Message\ServerRequestInterface;
use Reconmap\ControllerTestCase;
use Reconmap\Repositories\VulnerabilityRepository;

class CloneVulnerabilityControllerTest extends ControllerTestCase
{
    public function testSuccess(): void
    {
        $userId = 1;

        $request = $this->createMock(ServerRequestInterface::class);
        $request->expects($this->once())
            ->method('getAttribute')
            ->with('userId')
            ->willReturn($userId);

        $mockVulnerabilityRepository = $this->createPartialMock(VulnerabilityRepository::class, ['clone']);
        $mockVulnerabilityRepository->expects($this->once())
            ->method('clone')
            ->with(5, 1)
            ->willReturn(['success' => true]);

        $args = ['vulnerabilityId' => 5];

        $controller = $this->injectController(new CloneVulnerabilityController($mockVulnerabilityRepository));
        $response = $controller($request, $args);

        $this->assertEquals(['success' => true], $response);
    }
}
