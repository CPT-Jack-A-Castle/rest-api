<?php declare(strict_types=1);

namespace Reconmap\Repositories;

use Reconmap\DatabaseTestCase;

class VulnerabilityStatsRepositoryTest extends DatabaseTestCase
{
    private VulnerabilityStatsRepository $subject;

    public function setUp(): void
    {
        $db = $this->getDatabaseConnection();
        $this->subject = new VulnerabilityStatsRepository($db);
    }

    public function testCountAll()
    {
        $total = $this->subject->countAll();
        $this->assertEquals(102, $total);
    }

    public function testCountByRisk()
    {
        $stats = $this->subject->findCountByRisk();
        $this->assertGreaterThan(1, $stats[0]['total']);
    }

    public function testCountByRiskOnInvalidProject()
    {
        $stats = $this->subject->findCountByRisk(-1);
        $this->assertEmpty($stats);
    }

    public function testCountByCategory()
    {
        $stats = $this->subject->findCountByCategory();
        $this->assertGreaterThan(1, $stats[0]['total']);
    }

    public function testCountByCategoryOnInvalidProject()
    {
        $stats = $this->subject->findCountByCategory(-1);
        $this->assertEmpty($stats);
    }
}
